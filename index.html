<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>RASIA — Monitoreo de Temperatura</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body { font-family: Arial, sans-serif; background:#f6f9fc; color:#111; margin:0; }
    header { background:#004aad; color:white; padding:15px; text-align:center; font-size:22px; }
    .container { max-width:900px; margin:20px auto; background:white; padding:20px; border-radius:10px; box-shadow:0 3px 6px rgba(0,0,0,0.1); }
    canvas { width:100%; height:300px; }
    button { background:#004aad; color:white; border:none; padding:10px 16px; border-radius:6px; cursor:pointer; }
    input { padding:8px; width:100%; border:1px solid #ccc; border-radius:5px; }
  </style>
</head>
<body>
  <header>RASIA — Monitoreo de Temperatura</header>
  <div class="container">
    <h3>Panel de conexión</h3>
    <p>Broker MQTT: <b>broker.hivemq.com</b> — Puerto: <b>8000</b> — Tópico: <b>rasia/temperatura</b></p>
    <canvas id="chart"></canvas>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.1.0/mqttws31.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    const client = new Paho.MQTT.Client("broker.hivemq.com", 8000, "RASIA_WEB_" + Math.floor(Math.random()*10000));
    const ctx = document.getElementById("chart").getContext("2d");
    const chart = new Chart(ctx, {type:"line",data:{labels:[],datasets:[{label:"Temperatura (°C)",data:[],borderColor:"#004aad",fill:false}]}});
    client.onMessageArrived = (msg)=>{
      try{
        const d=JSON.parse(msg.payloadString);
        chart.data.labels.push(new Date().toLocaleTimeString());
        chart.data.datasets[0].data.push(d.valor);
        if(chart.data.labels.length>30){chart.data.labels.shift();chart.data.datasets[0].data.shift();}
        chart.update();
      }catch(e){console.error(e);}
    };
    client.connect({onSuccess:()=>{client.subscribe("rasia/temperatura");}});
  </script>
</body>
</html>